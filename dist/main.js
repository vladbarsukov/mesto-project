(()=>{"use strict";var t=document.querySelector(".photo-grid"),e=document.querySelector("#card-template").content,o=document.querySelector("#popupPhoto"),n=document.querySelector(".popup__photo-title"),r=y.querySelector(".popup__submit"),a=document.querySelector(".popup__photo");function i(t){t.classList.remove("popup_opened")}var c=function(t,e,o){(function(t,e){return fetch("https://nomoreparties.co/v1/plus-cohort-15/cards/likes/".concat(t),{method:e?"DELETE":"PUT",headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea","Content-Type":"application/json"}}).then(_)})(t,e).then((function(t){u(o,t.likes,f)})).catch((function(t){console.log(t)}))};function u(t,e,o){var n=t.querySelector(".photo-grid__like");t.querySelector(".photo-grid__like-counter").textContent=e.length,function(t,e){return Boolean(t.find((function(t){return t._id===e})))}(e,o)?n.classList.add("photo-grid__like_active"):n.classList.remove("photo-grid__like_active")}function s(o,n){var r=function(t,o,n,r){var a=e.cloneNode(!0),i=a.querySelector(".photo-grid__like"),c=a.querySelector(".photo-grid__item"),s=a.querySelector(".photo-grid__del-button");return a.querySelector(".photo-grid__picture").owner="".concat(t._id),a.querySelector(".photo-grid__text").textContent=t.name,a.querySelector(".photo-grid__picture").src=t.link,a.querySelector(".photo-grid__picture").alt=t.name,u(a,t.likes,o),t.owner._id!==o&&a.querySelector(".photo-grid__del-button").remove(),s.addEventListener("click",(function(){r(c,t._id)})),i.addEventListener("click",(function(){n(t._id,i.classList.contains("photo-grid__like_active"),c)})),a}(o,n,c,p);t.prepend(r)}function p(t,e){var o;(o=e,fetch("https://nomoreparties.co/v1/plus-cohort-15/cards/".concat(o),{method:"DELETE",headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea","Content-Type":"application/json"}}).then(_)).then((function(){t.remove()})).catch((function(t){console.log(t)}))}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,n=new Array(e);o<e;o++)n[o]=t[o];return n}var d=document.querySelector(".profile__image"),f=null,_=function(t){return t.ok?t.json():Promise.reject(t)};Promise.all([fetch("https://nomoreparties.co/v1/plus-cohort-15/cards ",{headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea"}}).then(_),fetch("https://nomoreparties.co/v1/plus-cohort-15/users/me ",{headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea"}}).then(_)]).then((function(t){var e,o,n=(o=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var n,r,a=[],i=!0,c=!1;try{for(o=o.call(t);!(i=(n=o.next()).done)&&(a.push(n.value),!e||a.length!==e);i=!0);}catch(t){c=!0,r=t}finally{try{i||null==o.return||o.return()}finally{if(c)throw r}}return a}}(e,o)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?l(t,e):void 0}}(e,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=n[0],a=n[1];C.textContent=a.name,E.textContent=a.about,d.src=a.avatar,f=a._id,r.reverse().forEach((function(t){s(t,f)}))}));var m=document.querySelector("#popupAddCard"),h=document.querySelector("#popupEditProfile"),v=document.querySelector("#popupProfileImage"),y=document.forms.formAddPhoto,b=document.forms.formProfile,g=document.forms.formAvatar,S=b.name,L=b.profession,q=g.linkAvatar,C=document.querySelector(".profile__name"),E=document.querySelector(".profile__description"),k=Array.from(b.querySelectorAll(".popup__input")),x=Array.from(g.querySelectorAll(".popup__input")),A=g.querySelector(".popup__submit"),P=b.querySelector(".popup__submit"),T=y.querySelector(".popup__input_place-error"),j=y.querySelector(".popup__input_link-error"),w=g.querySelector(".popup__input_avatar-error");function z(t){t.classList.add("popup_opened")}function D(t){t.classList.remove("popup_opened")}function O(){S.value=C.textContent,L.value=E.textContent,N(S,b),N(L,b)}var I=function(t,e){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.removeAttribute("disabled"),e.classList.remove("popup__submit_disabled")):(e.classList.add("popup__submit_disabled"),e.disabled=!0)},N=function(t,e){t.validity.valid?function(t,e){var o=e.querySelector(".".concat(t.id,"-error"));o.classList.remove("popup__input-error_active"),o.textContent=""}(t,e):function(t,e,o){var n=o.querySelector(".".concat(t.id,"-error"));n.classList.add("popup__input-error_active"),t.validity.patternMismatch?n.textContent=t.dataset.pattern:n.textContent=e}(t,t.validationMessage,e)};function J(){T.classList.remove("popup__input-error_active"),j.classList.remove("popup__input-error_active"),w.classList.remove("popup__input-error_active")}b.addEventListener("submit",(function(t){var e,o;t.preventDefault(),(e=S.value,o=L.value,fetch("https://nomoreparties.co/v1/plus-cohort-15/users/me",{method:"PATCH",headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea","Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then(_)).then((function(t){P.textContent="Сохранение...",C.textContent=t.name,E.textContent=t.about})).then((function(){D(h)})).finally((function(){P.textContent="Сохранить"})).catch((function(t){console.log(t)}))})),g.addEventListener("submit",(function(t){var e;t.preventDefault(),(e=q.value,fetch("https://nomoreparties.co/v1/plus-cohort-15/users/me/avatar",{method:"PATCH",headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then(_)).then((function(t){A.textContent="Создание...",d.src=t.avatar})).then((function(){D(v)})).finally((function(){A.textContent="Создать"})).catch((function(t){console.log(t)})),g.reset()})),y.addEventListener("submit",(function(t){var e,o;t.preventDefault(),(e=y.linkPicture.value,o=y.namePlace.value,fetch("https://nomoreparties.co/v1/plus-cohort-15/cards",{method:"POST",headers:{authorization:"e807f0be-4a7f-40ad-a75f-bff7cd3e53ea","Content-Type":"application/json"},body:JSON.stringify({link:e,name:o})}).then(_)).then((function(t){r.textContent="Создание...",s(t,f)})).finally((function(){r.textContent="Создать"})).catch((function(t){console.log(t)})),i(m),t.target.reset()})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t){var e=Array.from(t.querySelectorAll(".popup__input")),o=t.querySelector(".popup__submit");e.forEach((function(n){n.addEventListener("input",(function(){N(n,t),I(e,o)}))}))}(t)})),document.addEventListener("mousedown",(function(t){t.target.classList.contains("popup__close-button")&&i(o),t.target.classList.contains("photo-grid__picture")&&function(t){o.classList.add("popup_opened"),function(t){n.textContent=t.target.alt,a.src=t.target.src,a.alt=n.textContent}(t)}(t),t.target.classList.contains("popup_opened")&&i(o)})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&i(o)})),document.addEventListener("mousedown",(function(t){t.target.classList.contains("popup__close-button")&&(i(h),i(m),i(v),y.reset(),g.reset(),J()),t.target.classList.contains("profile__add-button")&&z(m),t.target.classList.contains("profile__edit-button")&&(O(),z(h),I(k,P)),t.target.classList.contains("profile__image")&&(O(),z(v),I(x,A)),t.target.classList.contains("popup_opened")&&(i(h),i(m),i(v),J(),y.reset(),g.reset())})),document.addEventListener("keydown",(function(t){"Escape"===t.key&&(i(h),i(m),i(v),J(),y.reset(),g.reset())}))})();